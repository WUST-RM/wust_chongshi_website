{% assign image = page.header | default: site.header | relative_url %}
{% assign dark = page.header-dark | is_nil: site.header-dark | is_nil: true %}
{% assign video =  page.header-video | default: site.header-video | relative_url %}

{% assign svg = "images/崇实战队logo图标.svg" | file_exists %}
{% assign png = "images/崇实战队logo图标.png" | file_exists %}
{% assign jpg = "images/崇实战队logo图标.jpg" | file_exists %}
{% assign logo = svg | default: png | default: jpg | default: nil %}

<header
  class="background"
  {% if page.url !="/" %}
    style="--image: url('{{ image }}')"
  {% endif %}
  {% if dark == true or dark == false %}
    data-dark="{{ dark }}"
  {% endif %}
  {% if page.url == "/" %}
    data-big
  {% endif %}
>
  {% if page.url=="/" %}
    <div id="particles-js"></div>
    <div class="overlay"></div>
    <video class="background-video" preload="auto" playsinline="true" x5-playsinline="true" webkit-playsinline="true" name="media" autoplay loop muted data-wf-ignore="true" data-object-fit="cover" poster="{{ image }}" src="{{ video | relative_url }}"></video>
  {% endif %}

  <a href="{{ "/" | relative_url }}" class="home">
    {% if logo %}
      <span class="logo">
        {% if svg %}
          {{ svg | file_read }}
        {% else %}
          <img src="{{ logo | relative_url }}" alt="logo">
        {% endif %}
      </span>
    {% endif %}
    {% if site.logo-text != false %}
      <span class="title-text" data-tooltip="主页">
        {% if site.title and site.show-title != false %}
          <span class="title">{{ site.title }}</span>
        {% endif %}
        {% if site.subtitle and site.show-subtitle != false %}
          <span class="subtitle">{{ site.subtitle }}</span>
        {% endif %}
        {% if site.slogan and site.show-slogan != false %}
          <span class="slogan">{{ site.slogan }}</span>
        {% endif %}
      </span>
    {% endif %}
  </a>

  <input class="nav-toggle" type="checkbox" aria-label="show/hide nav">

  <nav>
    {% assign pages = site.pages
      | where_exp: "page", "page.nav"
      | sort: "nav.order"
    %}
    {% for page in pages %}
      {% if page.nav %}
        <a
          href="{{ page.dir | relative_url }}"
          data-tooltip="{{ page.nav.tooltip }}"
        >
          {{ page.title }}
        </a>
      {% endif %}
    {% endfor %}
  </nav>
</header>

<style>
/* 背景样式 + 渐变光晕 */
header.background {
  position: relative;
  overflow: hidden;
  background: linear-gradient(135deg, rgba(0, 255, 255, 0.15), rgba(0, 100, 255, 0.15)),
              var(--image) no-repeat center/cover;
}

/* 覆盖层 */
header.background .overlay {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.45);
  -webkit-backdrop-filter: blur(4px);
  backdrop-filter: blur(4px);
  z-index: 1;
  pointer-events: none;
}

/* 粒子背景 */
#particles-js {
  position: absolute;
  inset: 0;
  z-index: 0;
  pointer-events: none;
}

/* 视频背景 */
.background-video {
  position: absolute;
  inset: 0;
  z-index: 0;
  filter: brightness(0.8) contrast(1.2) saturate(1.1);
  animation: fadein 1.5s ease forwards;
  pointer-events: none;
}
@keyframes fadein {
  from { opacity: 0; }
  to   { opacity: 1; }
}

/* 光晕动画 */
header.background::after {
  content: "";
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at 20% 30%, rgba(0,255,255,0.25), transparent 70%),
              radial-gradient(circle at 80% 70%, rgba(0,100,255,0.25), transparent 70%);
  animation: pulse 6s infinite alternate;
  z-index: 0;
  pointer-events: none;
}
@keyframes pulse {
  0% { opacity: 0.4; }
  100% { opacity: 0.8; }
}

/* Logo 发光悬停 */
.logo svg path, .logo img {
  filter: drop-shadow(0 0 8px cyan);
  transition: transform 0.3s ease;
}
.logo:hover svg, .logo:hover img {
  transform: scale(1.05);
}

/* 导航栏 */
nav a {
  position: relative;
  color: #0ff;
  text-decoration: none;
  padding: 10px 15px;
  transition: all 0.3s ease;
}
nav a::after {
  content: "";
  position: absolute;
  left: 0;
  bottom: 2px;
  width: 0;
  height: 2px;
  background: cyan;
  transition: width 0.3s ease;
}
nav a:hover {
  color: #fff;
  text-shadow: 0 0 6px cyan;
}
nav a:hover::after {
  width: 100%;
}

/* 提升导航和 Logo 层级，确保可点击 */
header.background .home,
header.background nav {
  position: relative;
  z-index: 5;
}
</style>

<!-- 粒子背景脚本 -->
<script src="https://cdn.jsdelivr.net/npm/particles.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function(){
  particlesJS("particles-js", {
    particles: {
      number: { value: 40 },
      color: { value: "#00ffff" },
      shape: { type: "circle" },
      opacity: { value: 0.4 },
      size: { value: 3 },
      line_linked: { enable: true, color: "#00ffff", opacity: 0.2 },
      move: { enable: true, speed: 1 }
    }
  });
});
</script>
